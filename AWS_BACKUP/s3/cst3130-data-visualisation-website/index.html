<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coursework2</title>
<!--    Plotly.js for graph plotting.-->
    <script src="https://cdn.plot.ly/plotly-2.8.3.min.js"></script>
</head>
<body>
<h1> Hello World!!</h1>
<p>Omer's Static Graph on the Cloud</p>
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://chart-studio.plotly.com/~omerka1/18.embed" height="525" width="100%"></iframe>'

<h1>Message for Server</h1>
<form>
    <input type="text" name="inputString" />
    <button type="button" onclick="sendMessage()">Submit</button>
</form>

<h1>Messages from Server</h1>
<p style="border-style: solid; width: 500px; border-width: 1px;" id="messages"></p>

<button type="button" onclick="updatePieChart()">Refresh</button>
<div id="pieDiv"></div>
<button type="button" onclick="updateNumericalGraph()">Refresh</button>
<div id="numericalGraphDiv"></div>
<script>
    //Open connection
    let connection = new WebSocket("wss://7dxr2k9a9b.execute-api.us-east-1.amazonaws.com/prod");

    //Log connected response
    connection.onopen = function(event){
        console.log("Connected: " + JSON.stringify(event));
        // updatePieChart();
        // updateNumericalGraph();
    };

    //Output messages from the server
    connection.onmessage = function(msg){
        let message = msg.data;

        if(message.includes("pie")) {
            let plotlyData = JSON.parse(message);
            let values = plotlyData.data.values;
            let labels = plotlyData.data.labels;
            let type = plotlyData.data.type;
            let pieLayout = plotlyData.layout;

            var data = [{
                values: values,
                labels: labels,
                type: type
            }];

            var layout = {
                height: 400,
                width: 500
            };
            Plotly.newPlot('pieDiv', data, pieLayout);
        } else if (message.includes("numerical")) {
            let plotlyData = JSON.parse(message);
            let lines = plotlyData.data;
            Plotly.newPlot('numericalGraphDiv', lines);
        } else {
            document.getElementById("messages").innerHTML += ("Server message: " + message + "<br />");
            console.log("Message received.");
        }
    }

    //Log errors
    connection.onerror = function (error) {
        console.log("WebSocket Error: " + JSON.stringify(error));
    }

    //Send message to server
    function sendMessage(){
        //Get text from form
        let msgText = document.forms[0].inputString.value;

        //Create message to be sent to server
        let msgObject = {
            sendData: "sendMessage",//Used for routing in API Gateway
            data: msgText
        };

        //Send message
        connection.send(JSON.stringify(msgObject));

        //Log result
        console.log("Message sent: " + JSON.stringify(msgObject));
    }

    //Send request message to update pie char to server
    function updatePieChart(){
        //Create message to be sent to server
        let msgObject = {
            sendData: "updatePie",//Used for routing in API Gateway
            data: ""
        };

        //Send message
        connection.send(JSON.stringify(msgObject));

        //Log result
        console.log("Message sent: " + JSON.stringify(msgObject));
    }

    //Send request message to update graph to server
    function updateNumericalGraph(){
        //Create message to be sent to server
        let msgObject = {
            sendData: "updateNumericalGraph",//Used for routing in API Gateway
            data: ""
        };

        //Send message
        connection.send(JSON.stringify(msgObject));

        //Log result
        console.log("Message sent: " + JSON.stringify(msgObject));
    }

</script>

</body>
</html>